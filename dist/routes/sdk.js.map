{"version":3,"sources":["../../src/routes/sdk.js"],"names":["router","Router","get","req","res","lang","params","ENABLE_AUTO_DOCS","status","send","publicUrl","method","url","json","swaggerUrl","err","data","body","type","rejectUnauthorized","link","on","pipe"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA,IAAMA,SAAS,kBAAQC,MAAR,EAAf;;AAEA;;;;;;;AAOAD,OAAOE,GAAP,CAAW,QAAX;AAAA,qFAAqB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAChBC,UADgB,GACTF,IAAIG,MAAJ,CAAWD,IADF;;AAAA,UAGhB,eAAWE,gBAHK;AAAA;AAAA;AAAA;;AAAA,uCAIZH,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,6BAArB,CAJY;;AAAA;AAAA;AAAA;AAAA,aASK,0BATL;;AAAA;AASbC,eATa;;;AAWnB,6BAAQ;AACPC,eAAQ,MADD;AAEPC,6DAAoDP,IAF7C;AAGPQ,aAAM;AACLC,oBAAeJ,SAAf;AADK;AAHC,OAAR,EAMG,UAACK,GAAD,EAAMC,IAAN,EAAYC,IAAZ,EAAqB;;AAEvB,WAAGF,OAAOE,KAAKC,IAAL,KAAc,OAAxB,EAAgC;AAC/B,eAAOd,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,kDAArB,CAAP;AACA;;AAED,8BAAQ;AACPE,gBAAQ,KADD;AAEPQ,4BAAoB,KAFb;AAGPP,aAAKK,KAAKG;AAHH,QAAR,EAIGC,EAJH,CAIM,OAJN,EAIe,YAAM;AACpB,eAAOjB,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,oBAArB,CAAP;AACA,QAND,EAMGa,IANH,CAMQlB,GANR;AAOA,OAnBD;;AAXmB;AAAA;;AAAA;AAAA;AAAA;AAAA,uCAiCZA,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,aAjCY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAArB;;AAAA;AAAA;AAAA;AAAA;;kBAsCeT,M","file":"sdk.js","sourcesContent":["import express from \"express\";\r\nimport configKeys from \"../config/keys\";\r\nimport request from \"request\";\r\nimport {getPublicUrl} from \"../helpers/ngrok\";\r\nconst router = express.Router();\r\n\r\n/**\r\n * Get the requested language sdk as zip file\r\n * Gets the public url froom ngrok\r\n * Makes REST request to Swagger generated API to get sdk\r\n * @param lang language\r\n * @returns zipfile\r\n */ \r\nrouter.get(\"/:lang\", async (req, res) => {\t    \r\n\tlet lang = req.params.lang;\r\n\r\n\tif(!configKeys.ENABLE_AUTO_DOCS){\r\n\t\treturn res.status(400).send(\"this feature is not enabled\");\r\n\t}\r\n\r\n\ttry {\r\n\r\n\t\tconst publicUrl = await getPublicUrl();\t\r\n\r\n\t\trequest({\r\n\t\t\tmethod: \"POST\", \r\n\t\t\turl: `http://generator.swagger.io/api/gen/clients/${lang}`,\r\n\t\t\tjson: {\r\n\t\t\t\tswaggerUrl: `${publicUrl}/api-docs`\t\r\n\t\t\t}\r\n\t\t}, (err, data, body) => {\r\n\r\n\t\t\tif(err || body.type === \"error\"){\r\n\t\t\t\treturn res.status(400).send(\"unable get the sdk, check the requested language\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trequest({\r\n\t\t\t\tmethod: \"GET\", \r\n\t\t\t\trejectUnauthorized: false, \r\n\t\t\t\turl: body.link\r\n\t\t\t}).on(\"error\", () => {\r\n\t\t\t\treturn res.status(400).send(\"unable get the sdk\");\r\n\t\t\t}).pipe(res);\r\n\t\t});\t\t\r\n\r\n\t}catch(err){\r\n\t\treturn res.status(400).send(err);\r\n\t}\r\n   \r\n});\r\n\r\nexport default router;\r\n"]}