{"version":3,"sources":["../../src/routes/sdk.js"],"names":["router","Router","get","req","res","lang","params","ENABLE_AUTO_DOCS","status","send","publicUrl","method","url","json","swaggerUrl","err","data","body","type","rejectUnauthorized","link","on","pipe"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA,IAAMA,SAAS,kBAAQC,MAAR,EAAf;;AAEA;;;;;;;AAOAD,OAAOE,GAAP,CAAW,QAAX;AAAA,qFAAqB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAChBC,UADgB,GACTF,IAAIG,MAAJ,CAAWD,IADF;;AAAA,UAGhB,eAAWE,gBAHK;AAAA;AAAA;AAAA;;AAAA,uCAIZH,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,6BAArB,CAJY;;AAAA;AAAA;AAAA;AAAA,aASK,0BATL;;AAAA;AASbC,eATa;;;AAWnB,6BAAQ;AACPC,eAAQ,MADD;AAEDC,6DAAoDP,IAFnD;AAGDQ,aAAM;AACRC,oBAAeJ,SAAf;AADQ;AAHL,OAAR,EAMK,UAACK,GAAD,EAAMC,IAAN,EAAYC,IAAZ,EAAqB;;AAEtB,WAAGF,OAAOE,KAAKC,IAAL,KAAc,OAAxB,EAAgC;AAC/B,eAAOd,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,kDAArB,CAAP;AACA;;AAED,8BAAQ;AACVE,gBAAQ,KADE;AAEJQ,4BAAoB,KAFhB;AAGJP,aAAKK,KAAKG;AAHN,QAAR,EAKCC,EALD,CAKI,OALJ,EAKa,eAAO;AACnB,eAAOjB,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,oBAArB,CAAP;AACH,QAPE,EAQFa,IARE,CAQGlB,GARH;AASH,OArBD;;AAXmB;AAAA;;AAAA;AAAA;AAAA;AAAA,uCAmCZA,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,aAnCY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAArB;;AAAA;AAAA;AAAA;AAAA;;kBAwCeT,M","file":"sdk.js","sourcesContent":["import express from \"express\";\r\nimport configKeys from \"../config/keys\";\r\nimport request from \"request\";\r\nimport {getPublicUrl} from \"../helpers/ngrok\";\r\nconst router = express.Router();\r\n\r\n/**\r\n * Get the requested language sdk as zip file\r\n * Gets the public url froom ngrok\r\n * Makes REST request to Swagger generated API to get sdk\r\n * @param lang language\r\n * @returns zipfile\r\n */ \r\nrouter.get(\"/:lang\", async (req, res) => {\t    \r\n\tlet lang = req.params.lang;\r\n\r\n\tif(!configKeys.ENABLE_AUTO_DOCS){\r\n\t\treturn res.status(400).send(\"this feature is not enabled\");\r\n\t}\r\n\r\n\ttry {\r\n\r\n\t\tconst publicUrl = await getPublicUrl();\t\r\n\t\t\r\n\t\trequest({\r\n\t\t\tmethod: \"POST\", \r\n\t        url: `http://generator.swagger.io/api/gen/clients/${lang}`,\r\n\t        json: {\r\n\t\t\t    swaggerUrl: `${publicUrl}/api-docs`\t\r\n\t\t\t}\r\n    \t},(err, data, body) => {\r\n    \t    \t\t\r\n    \t\tif(err || body.type === \"error\"){\r\n    \t\t\treturn res.status(400).send(\"unable get the sdk, check the requested language\");\r\n    \t\t}\r\n\r\n\t\t    request({\r\n\t\t\t\tmethod: \"GET\", \r\n\t\t        rejectUnauthorized: false, \r\n\t\t        url: body.link\r\n\t    \t})\r\n\t    \t.on('error', err => {\r\n\t\t\t    return res.status(400).send(\"unable get the sdk\");\r\n\t\t\t})\r\n\t\t\t.pipe(res);\r\n\t\t});\t\t\r\n\r\n\t}catch(err){\r\n\t\treturn res.status(400).send(err);\r\n\t}\r\n   \r\n});\r\n\r\nexport default router;\r\n"]}